<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Certificate Emailer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app" id="app">

        <!-- ‚ïê‚ïê‚ïê Sidebar ‚ïê‚ïê‚ïê -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">
                    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color:#818cf8"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 7l-10 7L2 7"/></svg>
                </div>
                <h1 class="logo-text">Certificate<br>Emailer</h1>
                <span class="logo-badge">v2.0</span>
            </div>

            <nav class="step-nav">
                <button class="step-btn active" data-step="home" onclick="goToStep('home')">
                    <span class="step-num">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    </span>
                    <div class="step-info">
                        <span class="step-label">Home</span>
                        <span class="step-status" id="status-home"></span>
                    </div>
                </button>
                <button class="step-btn" data-step="0" onclick="goToStep(0)">
                    <span class="step-num">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                    </span>
                    <div class="step-info">
                        <span class="step-label">Setup</span>
                        <span class="step-status" id="status-0"></span>
                    </div>
                </button>
                <div class="nav-divider"></div>
                <button class="step-btn" data-step="1" onclick="goToStep(1)">
                    <span class="step-num">1</span>
                    <div class="step-info">
                        <span class="step-label">Data &amp; Mapping</span>
                        <span class="step-status" id="status-1"></span>
                    </div>
                    <span class="step-check hidden" id="check-1">&#10003;</span>
                </button>
                <button class="step-btn" data-step="2" onclick="goToStep(2)">
                    <span class="step-num">2</span>
                    <div class="step-info">
                        <span class="step-label">Template</span>
                        <span class="step-status" id="status-2"></span>
                    </div>
                    <span class="step-check hidden" id="check-2">&#10003;</span>
                </button>
                <button class="step-btn" data-step="3" onclick="goToStep(3)">
                    <span class="step-num">3</span>
                    <div class="step-info">
                        <span class="step-label">Authentication</span>
                        <span class="step-status" id="status-3"></span>
                    </div>
                    <span class="step-check hidden" id="check-3">&#10003;</span>
                </button>
                <button class="step-btn" data-step="4" onclick="goToStep(4)">
                    <span class="step-num">4</span>
                    <div class="step-info">
                        <span class="step-label">Email Config</span>
                        <span class="step-status" id="status-4"></span>
                    </div>
                </button>
                <button class="step-btn" data-step="5" onclick="goToStep(5)">
                    <span class="step-num">5</span>
                    <div class="step-info">
                        <span class="step-label">Run</span>
                        <span class="step-status" id="status-5"></span>
                    </div>
                </button>
            </nav>

            <div class="sidebar-footer">
                <button class="theme-btn" id="theme-btn" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span> Dark Mode
                </button>
            </div>
        </aside>

        <!-- ‚ïê‚ïê‚ïê Mobile Header ‚ïê‚ïê‚ïê -->
        <div class="mobile-header">
            <button class="hamburger" id="hamburger-btn" onclick="toggleMobileNav()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="mobile-title">Certificate Emailer</span>
        </div>
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileNav()"></div>

        <!-- ‚ïê‚ïê‚ïê Main Content ‚ïê‚ïê‚ïê -->
        <main class="main">
            <!-- Toast notifications -->
            <div id="toast-container" class="toast-container"></div>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Home Page ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel active" id="panel-home">
                <div class="hero">
                    <div class="hero-badge">Open Source Tool</div>
                    <h1 class="hero-title">Bulk Certificate<br><span class="gradient-text">Emailer</span></h1>
                    <p class="hero-subtitle">
                        Generate personalized PDF certificates from Word templates and email them to hundreds of recipients ‚Äî all from one simple interface.
                    </p>
                    <div class="hero-actions">
                        <button class="btn btn-primary btn-lg hero-btn" onclick="goToStep(0)">
                            Get Started
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                        </button>
                    </div>
                </div>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üìä</div>
                        <h3>Smart Data Import</h3>
                        <p>Upload CSV or Excel files with automatic format correction, encoding detection, and column mapping.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìù</div>
                        <h3>Template Engine</h3>
                        <p>Use branded .docx Word templates with <code>{{placeholders}}</code> that get replaced per recipient.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üé®</div>
                        <h3>Rich Email Editor</h3>
                        <p>Compose HTML emails with formatting, images, and signatures. Full WYSIWYG editing.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚ö°</div>
                        <h3>Bulk Processing</h3>
                        <p>Generate PDFs and send emails with real-time progress tracking and automatic retry on failures.</p>
                    </div>
                </div>

                <div class="how-it-works">
                    <h2>How It Works</h2>
                    <div class="steps-timeline">
                        <div class="timeline-item">
                            <div class="timeline-num">1</div>
                            <div class="timeline-content">
                                <strong>Upload Data</strong>
                                <p>Import your Excel/CSV with names, emails, and other fields</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-num">2</div>
                            <div class="timeline-content">
                                <strong>Add Template</strong>
                                <p>Upload a .docx certificate template with {{placeholders}}</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-num">3</div>
                            <div class="timeline-content">
                                <strong>Configure</strong>
                                <p>Set up Gmail auth, email subject/body, and filename pattern</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-num">4</div>
                            <div class="timeline-content">
                                <strong>Send</strong>
                                <p>Hit start and watch certificates fly out in real time</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Step 0: Setup / Health Check ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel" id="panel-0">
                <div class="panel-header">
                    <div class="panel-header-row">
                        <div>
                            <div class="step-badge">Setup</div>
                            <h2>Environment Setup</h2>
                            <p class="subtitle">Verify your system is ready to run</p>
                        </div>
                        <div class="nav-buttons">
                            <button class="btn btn-secondary" onclick="goToStep('home')">&larr; Home</button>
                            <button class="btn btn-primary" onclick="goToStep(1)">Next &rarr;</button>
                        </div>
                    </div>
                </div>

                <div class="card card-hover">
                    <div class="flex-between">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            System Health Check
                        </h3>
                        <button class="btn btn-sm btn-primary" id="run-check-btn" onclick="runHealthCheck()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-1.64-8.36L23 10"/></svg>
                            Run Check
                        </button>
                    </div>
                    <div id="health-loading" class="hidden">
                        <div class="loading-spinner"></div>
                        <p class="hint" style="text-align:center;">Checking system‚Ä¶</p>
                    </div>
                    <div id="health-info" class="hint" style="margin-bottom:12px;"></div>
                    <ul class="checklist" id="health-checks"></ul>
                    <div id="health-result" class="status-msg" style="margin-top:16px;"></div>
                </div>

                <div class="card card-hover">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="9" x2="16" y2="9"/><line x1="8" y1="13" x2="12" y2="13"/></svg>
                        Quick Setup (Terminal)
                    </h3>
                    <p class="hint">If checks fail, run this command in the <code>web_app</code> folder:</p>
                    <pre class="code-block">python setup.py</pre>
                    <p class="hint" style="margin-top:8px;">This will automatically create a virtual environment, install all dependencies, and launch the app.</p>
                </div>
            </section>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Step 1: Data & Mapping ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel" id="panel-1">
                <div class="panel-header">
                    <div class="panel-header-row">
                        <div>
                            <div class="step-badge">Step 1 of 5</div>
                            <h2>Data &amp; Mapping</h2>
                            <p class="subtitle">Upload your data file and map columns to template placeholders</p>
                        </div>
                        <div class="nav-buttons">
                            <button class="btn btn-secondary" onclick="goToStep(0)">&larr; Back</button>
                            <button class="btn btn-primary" onclick="goToStep(2)">Next &rarr;</button>
                        </div>
                    </div>
                </div>

                <div class="card card-hover">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                        Upload Data File
                    </h3>
                    <div class="upload-zone" id="data-zone">
                        <div class="upload-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color:var(--accent)"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        </div>
                        <p class="upload-label">Drag &amp; drop your Excel or CSV file here</p>
                        <p class="upload-hint">or click to browse &middot; .xlsx, .csv</p>
                        <input type="file" id="data-input" accept=".csv,.xls,.xlsx" hidden>
                    </div>
                    <div class="file-info" id="data-info"></div>
                </div>

                <div class="card hidden" id="fixes-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--warning)"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                        Auto-corrections Applied
                    </h3>
                    <ul class="fixes-list" id="fixes-list"></ul>
                </div>

                <div class="card hidden" id="mapping-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
                        Column &rarr; Placeholder Mapping
                    </h3>
                    <p class="hint">Each column is mapped to a placeholder name. Edit if needed (lowercase, no spaces).</p>
                    <div class="table-wrap">
                        <table class="tbl">
                            <thead><tr><th>Column</th><th>Placeholder</th></tr></thead>
                            <tbody id="mapping-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card hidden" id="preview-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                        Data Preview
                    </h3>
                    <div class="table-wrap">
                        <table class="tbl">
                            <thead id="preview-head"></thead>
                            <tbody id="preview-body"></tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <button class="btn btn-sm" id="prev-btn" onclick="changePage(-1)" disabled>&larr; Prev</button>
                        <span id="page-info">Page 1 of 1</span>
                        <button class="btn btn-sm" id="next-btn" onclick="changePage(1)" disabled>Next &rarr;</button>
                    </div>
                </div>
            </section>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Step 2: Template ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel" id="panel-2">
                <div class="panel-header">
                    <div class="panel-header-row">
                        <div>
                            <div class="step-badge">Step 2 of 5</div>
                            <h2>Template</h2>
                            <p class="subtitle">Upload and preview your .docx certificate template</p>
                        </div>
                        <div class="nav-buttons">
                            <button class="btn btn-secondary" onclick="goToStep(1)">&larr; Back</button>
                            <button class="btn btn-primary" onclick="goToStep(3)">Next &rarr;</button>
                        </div>
                    </div>
                </div>

                <div class="card card-hover">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Upload Template
                    </h3>
                    <div class="upload-zone" id="template-zone">
                        <div class="upload-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color:var(--accent)"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        </div>
                        <p class="upload-label">Drag &amp; drop your .docx template here</p>
                        <p class="upload-hint">or click to browse</p>
                        <input type="file" id="template-input" accept=".docx" hidden>
                    </div>
                    <div class="file-info" id="template-info"></div>
                </div>

                <div class="card hidden" id="vars-card">
                    <h3>Detected Template Variables</h3>
                    <div id="template-vars" class="tag-list"></div>
                </div>

                <div class="card hidden" id="tpl-preview-card">
                    <h3>Template Preview</h3>
                    <div id="template-preview" class="tpl-preview"></div>
                </div>
            </section>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Step 3: Authentication ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel" id="panel-3">
                <div class="panel-header">
                    <div class="panel-header-row">
                        <div>
                            <div class="step-badge">Step 3 of 5</div>
                            <h2>Authentication</h2>
                            <p class="subtitle">Configure your Gmail credentials for sending emails</p>
                        </div>
                        <div class="nav-buttons">
                            <button class="btn btn-secondary" onclick="goToStep(2)">&larr; Back</button>
                            <button class="btn btn-primary" onclick="goToStep(4)">Next &rarr;</button>
                        </div>
                    </div>
                </div>

                <div class="card card-hover">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
                        Gmail SMTP Settings
                    </h3>
                    <div class="form-group">
                        <label for="auth-email">Email Address</label>
                        <input type="email" id="auth-email" class="input" placeholder="you@gmail.com">
                    </div>
                    <div class="form-group">
                        <label for="auth-password">App Password</label>
                        <input type="password" id="auth-password" class="input" placeholder="16-character app password">
                        <p class="hint">
                            Generate at
                            <a href="https://myaccount.google.com/apppasswords" target="_blank" rel="noopener">
                                Google Account &rarr; App Passwords
                            </a>
                        </p>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="saveCredentials()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
                            Save Credentials
                        </button>
                        <button class="btn btn-secondary" onclick="testConnection()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            Test Connection
                        </button>
                    </div>
                    <div id="auth-status" class="status-msg"></div>
                </div>
            </section>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Step 4: Email Configuration ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel" id="panel-4">
                <div class="panel-header">
                    <div class="panel-header-row">
                        <div>
                            <div class="step-badge">Step 4 of 5</div>
                            <h2>Email Configuration</h2>
                            <p class="subtitle">Set up the email content and output filename pattern</p>
                        </div>
                        <div class="nav-buttons">
                            <button class="btn btn-secondary" onclick="goToStep(3)">&larr; Back</button>
                            <button class="btn btn-primary" onclick="goToStep(5)">Next &rarr;</button>
                        </div>
                    </div>
                </div>

                <div class="card card-hover">
                    <div class="form-group">
                        <label for="recipient-col">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:4px"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg>
                            Recipient Email Column
                        </label>
                        <select id="recipient-col" class="input">
                            <option value="">-- Select column --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="email-subject">Email Subject</label>
                        <input type="text" id="email-subject" class="input" placeholder="e.g. CERTIFICATE">
                    </div>
                    <div class="form-group">
                        <label>Email Body <span class="hint" style="display:inline">(Rich HTML ‚Äî supports formatting, images, signatures)</span></label>
                        <div class="editor-toolbar" id="editor-toolbar">
                            <button type="button" onclick="editorCmd('bold')" title="Bold"><b>B</b></button>
                            <button type="button" onclick="editorCmd('italic')" title="Italic"><i>I</i></button>
                            <button type="button" onclick="editorCmd('underline')" title="Underline"><u>U</u></button>
                            <span class="toolbar-sep"></span>
                            <button type="button" onclick="editorCmd('insertUnorderedList')" title="Bullet list">‚Ä¢ List</button>
                            <button type="button" onclick="editorCmd('insertOrderedList')" title="Numbered list">1.</button>
                            <span class="toolbar-sep"></span>
                            <select onchange="editorFontSize(this.value); this.selectedIndex=0;" title="Font size">
                                <option value="">Size</option>
                                <option value="1">Small</option>
                                <option value="3">Normal</option>
                                <option value="5">Large</option>
                                <option value="7">Huge</option>
                            </select>
                            <input type="color" id="editor-color" value="#333333" onchange="editorCmd('foreColor', this.value)" title="Text color">
                            <span class="toolbar-sep"></span>
                            <button type="button" onclick="editorInsertLink()" title="Insert link">üîó</button>
                            <button type="button" onclick="editorInsertImage()" title="Insert image (paste URL)">üñº</button>
                            <button type="button" onclick="editorInsertHR()" title="Horizontal line">‚Äï</button>
                            <span class="toolbar-sep"></span>
                            <button type="button" onclick="toggleHtmlSource()" title="View/Edit raw HTML" id="html-source-btn">&lt;/&gt;</button>
                        </div>
                        <div id="email-body" class="rich-editor" contenteditable="true"></div>
                        <textarea id="email-body-source" class="input textarea hidden" rows="12" spellcheck="false"></textarea>
                        <p class="hint">Type <code>{{placeholder}}</code> for personalisation. Use üñº to embed signature images.</p>
                    </div>
                    <div class="form-group">
                        <label for="filename-pattern">Filename Pattern</label>
                        <input type="text" id="filename-pattern" class="input" placeholder="e.g. certificate_{{name}}.pdf">
                        <p class="hint">Use <code>{{placeholder}}</code> to personalise each filename.</p>
                    </div>
                </div>

                <div class="card hidden" id="placeholders-card">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                        Available Placeholders
                    </h3>
                    <p class="hint">Click a tag to insert it into the editor.</p>
                    <div id="placeholders-list" class="tag-list"></div>
                </div>
            </section>

            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ Step 5: Run ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <section class="panel" id="panel-5">
                <div class="panel-header">
                    <div class="panel-header-row">
                        <div>
                            <div class="step-badge">Step 5 of 5</div>
                            <h2>Run</h2>
                            <p class="subtitle">Review the checklist and start processing</p>
                        </div>
                        <div class="nav-buttons">
                            <button class="btn btn-secondary" onclick="goToStep(4)">&larr; Back</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="flex-between">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-3px;margin-right:6px;color:var(--accent)"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            Pre-flight Checklist
                        </h3>
                        <button class="btn btn-sm btn-primary" onclick="runValidation()">Validate Data</button>
                    </div>
                    <ul class="checklist" id="checklist"></ul>
                    <div id="validation-results" class="hidden" style="margin-top:12px;"></div>
                </div>

                <div class="card">
                    <div class="mode-buttons">
                        <button class="btn btn-primary btn-lg" id="generate-btn" onclick="startProcessing('generate')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            Generate Only
                        </button>
                        <button class="btn btn-accent btn-lg" id="send-btn" onclick="startProcessing('send')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg>
                            Send Only
                        </button>
                        <button class="btn btn-success btn-lg" id="both-btn" onclick="startProcessing('both')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                            Generate &amp; Send
                        </button>
                    </div>
                    <p class="hint" style="margin-top:10px;text-align:center;">
                        <strong>Generate Only</strong> ‚Äî create PDFs without emailing &nbsp;¬∑&nbsp;
                        <strong>Send Only</strong> ‚Äî email previously generated PDFs &nbsp;¬∑&nbsp;
                        <strong>Generate &amp; Send</strong> ‚Äî do both in sequence
                    </p>

                    <div class="progress-section hidden" id="progress-section">
                        <div class="progress-header">
                            <span id="phase-label" class="phase-label">Preparing‚Ä¶</span>
                            <span id="progress-count" class="progress-count">0 / 0</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <div class="progress-pct" id="progress-pct">0%</div>
                    </div>
                </div>

                <div class="card hidden" id="log-card">
                    <div class="log-header">
                        <h3>Activity Log</h3>
                        <button class="btn btn-sm btn-secondary" onclick="clearLog()">Clear</button>
                    </div>
                    <div class="log-area" id="log-area"></div>
                </div>

                <div class="card hidden" id="results-card">
                    <h3>Results</h3>
                    <div id="results-summary"></div>
                    <div class="btn-row" style="margin-top:12px;">
                        <button class="btn btn-secondary hidden" id="download-failed-btn" onclick="downloadFailed()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Download Failed List (CSV)
                        </button>
                        <button class="btn btn-accent hidden" id="send-after-generate-btn" onclick="startProcessing('send')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg>
                            Now Send Emails
                        </button>
                    </div>
                </div>
            </section>

            <!-- ‚ïê‚ïê‚ïê Footer ‚ïê‚ïê‚ïê -->
            <footer class="app-footer">
                <p>Made with <span class="heart">‚ù§Ô∏è</span> by <strong>Ekansh Chauhan</strong></p>
            </footer>
        </main>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>